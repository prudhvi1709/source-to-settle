<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Source-to-Settle AI Demo</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9IiMyNTYzZWIiLz48cGF0aCBmaWxsPSIjZmZmIiBkPSJtMTYgNyAyIDcgNyAyLTcgMi0yIDctMi03LTctMiA3LTJaIi8+PC9zdmc+">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/styles/github-dark.min.css" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
  <style>
    .workflow-stage {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .workflow-stage:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .workflow-stage.active {
      border: 2px solid #0d6efd;
      box-shadow: 0 0 20px rgba(13,110,253,0.3);
    }
    .workflow-stage.completed {
      border: 2px solid #198754;
    }
    .stage-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    .file-upload-zone {
      border: 2px dashed #dee2e6;
      border-radius: 0.5rem;
      padding: 3rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .file-upload-zone:hover {
      border-color: #0d6efd;
      background-color: rgba(13,110,253,0.05);
    }
    .file-upload-zone.dragover {
      border-color: #0d6efd;
      background-color: rgba(13,110,253,0.1);
    }
    .file-preview {
      max-width: 100%;
      max-height: 400px;
      overflow: auto;
      border: 1px solid #dee2e6;
      border-radius: 0.5rem;
      padding: 1rem;
    }
    .agent-response {
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .progress-timeline {
      position: relative;
      padding-left: 30px;
    }
    .progress-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #dee2e6;
    }
    .timeline-item {
      position: relative;
      padding-bottom: 2rem;
    }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -24px;
      top: 5px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--bs-body-bg);
      border: 2px solid #dee2e6;
    }
    .timeline-item.completed::before {
      background: #198754;
      border-color: #198754;
    }
    .timeline-item.active::before {
      background: #0d6efd;
      border-color: #0d6efd;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(13,110,253,0.7); }
      50% { box-shadow: 0 0 0 10px rgba(13,110,253,0); }
    }

    /* Horizontal Timeline */
    .progress-timeline-horizontal {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      position: relative;
      padding: 20px 0;
      overflow-x: auto;
    }
    .progress-timeline-horizontal::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      top: 30px;
      height: 2px;
      background: #dee2e6;
      z-index: 0;
    }
    .progress-timeline-horizontal .timeline-item {
      flex: 1;
      min-width: 120px;
      text-align: center;
      position: relative;
      padding: 0 10px;
      z-index: 1;
    }
    .progress-timeline-horizontal .timeline-item::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 24px;
      transform: translateX(-50%);
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--bs-body-bg);
      border: 2px solid #dee2e6;
      z-index: 2;
    }
    .progress-timeline-horizontal .timeline-item.completed::before {
      background: #198754;
      border-color: #198754;
    }
    .progress-timeline-horizontal .timeline-item.active::before {
      background: #0d6efd;
      border-color: #0d6efd;
      animation: pulse 2s infinite;
    }
    .progress-timeline-horizontal .timeline-item i {
      font-size: 1.2rem;
      display: block;
      margin-bottom: 5px;
    }
    .progress-timeline-horizontal .timeline-item h6 {
      font-size: 0.85rem;
      margin-top: 35px;
      margin-bottom: 0;
      font-weight: 600;
    }
    .progress-timeline-horizontal .timeline-item small {
      display: block;
      margin-top: 5px;
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .narrative {
      max-width: 900px;
    }
    .accordion-button:not(.collapsed) {
      background-color: rgba(13, 110, 253, 0.1);
      color: #0d6efd;
    }
    .agent-data-tables .card {
      border-left: 3px solid #0d6efd;
    }
    .agent-data-tables .table th {
      font-weight: 600;
      opacity: 0.9;
    }
    .agent-data-tables .table-hover tbody tr:hover {
      background-color: rgba(13, 110, 253, 0.05);
    }
    .final-verdict .card {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }
    .final-verdict .card:hover {
      transform: translateY(-2px);
    }
    .final-verdict .display-1 {
      font-size: 5rem;
    }
    .final-verdict .progress {
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    @keyframes pulse-verdict {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    .final-verdict .bi-check-circle-fill,
    .final-verdict .bi-x-circle-fill {
      animation: pulse-verdict 2s ease-in-out;
    }

    /* Workflow Banner - Sticky at top */
    .workflow-banner {
      background: var(--bs-body-bg);
      border-bottom: 2px solid var(--bs-border-color);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 1020;
      transition: all 0.3s ease;
    }
    .workflow-banner.sticky-top {
      top: 0;
    }
    .workflow-banner-header {
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .workflow-banner-header:hover {
      background-color: rgba(13, 110, 253, 0.05);
    }
    .workflow-banner-content {
      border-top: 1px solid var(--bs-border-color);
      background: var(--bs-body-bg);
      max-height: 600px;
      overflow-y: auto;
    }
    #workflow-toggle-btn i {
      transition: transform 0.3s ease;
    }
    #workflow-toggle-btn[aria-expanded="true"] i {
      transform: rotate(180deg);
    }

    /* D3 Workflow Visualization */
    #workflow-viz-container {
      background: var(--bs-body-bg);
      border-radius: 0.5rem;
      padding: 2rem 1rem;
      min-height: 400px;
      position: relative;
    }
    #workflow-viz-container svg text {
      fill: var(--bs-body-color, #212529);
    }
    [data-bs-theme="dark"] #workflow-viz-container svg rect:first-child {
      fill: #2b3035;
      stroke: #495057;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      #workflow-viz-container {
        min-height: 300px;
        padding: 1rem 0.5rem;
      }
      .workflow-banner-content {
        max-height: 400px;
      }
    }
    .agent-node {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .agent-node.pending { opacity: 0.5; }
    .agent-node.not-applicable { opacity: 0.3; }
    .agent-node.active { filter: drop-shadow(0 0 15px rgba(13, 110, 253, 0.8)); }
    .agent-node.completed { filter: drop-shadow(0 0 10px rgba(25, 135, 84, 0.6)); }
    .agent-node.error { filter: drop-shadow(0 0 10px rgba(220, 53, 69, 0.6)); }
    
    .agent-card-viz {
      background: var(--bs-card-bg);
      border: 2px solid var(--bs-border-color);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      min-width: 140px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .agent-node.active rect:first-child {
      stroke: #0d6efd;
      stroke-width: 3;
      fill: rgba(13, 110, 253, 0.1);
    }
    .agent-node.completed rect:first-child {
      stroke: #198754;
      stroke-width: 3;
      fill: rgba(25, 135, 84, 0.05);
    }
    .agent-node.error rect:first-child {
      stroke: #dc3545;
      stroke-width: 3;
      fill: rgba(220, 53, 69, 0.05);
    }
    .agent-node.not-applicable rect:first-child {
      stroke: #6c757d;
      fill: rgba(108, 117, 125, 0.05);
      opacity: 0.5;
    }
    .agent-node.not-applicable text {
      opacity: 0.5;
    }
    
    .agent-icon-viz {
      font-size: 2.5rem;
      margin-bottom: 8px;
      display: block;
    }
    .agent-name-viz {
      font-size: 0.85rem;
      font-weight: 600;
      margin: 5px 0;
      line-height: 1.2;
    }
    .agent-stage-viz {
      font-size: 0.7rem;
      opacity: 0.7;
    }
    .agent-status-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 0.65rem;
      padding: 2px 6px;
      border-radius: 10px;
    }
    
    .flow-link {
      fill: none;
      stroke: #dee2e6;
      stroke-width: 2;
      opacity: 0.3;
    }
    .flow-link.active {
      stroke: #0d6efd;
      stroke-width: 3;
      opacity: 0.8;
      animation: dash 1s linear infinite;
    }
    .flow-link.completed {
      stroke: #198754;
      stroke-width: 2.5;
      opacity: 0.6;
    }
    
    @keyframes dash {
      to { stroke-dashoffset: -20; }
    }
    
    .data-particle {
      fill: #0d6efd;
      filter: drop-shadow(0 0 4px rgba(13, 110, 253, 0.8));
    }

    /* Legend */
    .workflow-legend {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--bs-card-bg);
      border: 1px solid var(--bs-border-color);
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 0.75rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
    }
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand" href=".">
        <i class="bi bi-robot me-2"></i>Source-to-Settle AI
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="#demo">Demo</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#data">Sample Data</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="process.html">Process</a>
          </li>
        </ul>
        <div class="nav-item dropdown ms-2" role="group" aria-label="Configure LLM" title="Configure LLM">
          <button id="configure-llm" class="btn btn-outline-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-magic"></i> <span class="d-lg-none ms-2">Configure LLM</span>
          </button>
        </div>
        <div class="nav-item dropdown ms-2" role="group" aria-label="Toggle dark mode" title="Toggle Dark Mode">
          <button class="dark-theme-toggle btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-circle-half"></i> <span class="d-lg-none ms-2">Toggle theme</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><button class="dropdown-item" data-bs-theme-value="light"><i class="me-2 bi bi-sun-fill"></i> Light</button></li>
            <li><button class="dropdown-item" data-bs-theme-value="dark"><i class="me-2 bi bi-moon-stars-fill"></i> Dark</button></li>
            <li><button class="dropdown-item" data-bs-theme-value="auto"><i class="me-2 bi bi-circle-half"></i> Auto</button></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Sticky Workflow Banner (hidden by default, shown during processing) -->
  <div id="workflow-banner" class="workflow-banner sticky-top d-none">
    <div class="container-fluid">
      <div class="workflow-banner-header" id="workflow-banner-header">
        <div class="d-flex justify-content-between align-items-center py-2">
          <div class="d-flex align-items-center gap-3">
            <i class="bi bi-diagram-3 fs-5"></i>
            <span class="fw-semibold" id="workflow-status-text">Processing Workflow</span>
            <span class="badge bg-primary" id="workflow-step-badge">Initializing...</span>
          </div>
          <button class="btn btn-sm btn-outline-secondary" id="workflow-toggle-btn" type="button">
            <i class="bi bi-chevron-down"></i> <span class="d-none d-md-inline">Show Details</span>
          </button>
        </div>
      </div>
      <div class="workflow-banner-content collapse" id="workflow-banner-content">
        <div class="py-3">
          <div id="workflow-viz-container"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <h1 class="display-4 my-4 text-center">Source-to-Settle AI Demo</h1>
    <h2 class="display-6 text-center text-muted">Intelligent Procurement Automation with Multi-Agent AI</h2>
    <div class="mx-auto my-4 narrative">
      <p>
        Welcome to the Source-to-Settle AI Demo â€” an intelligent, autonomous system that transforms procurement operations
        from vendor onboarding to payment execution. This application demonstrates how six specialized AI agents work together
        to process documents, validate vendors, generate contracts, process invoices, and execute payments with minimal human intervention.
      </p>
      <p>
        Upload any procurement document (PDF invoices, Excel reports, Word contracts, scanned KYC documents) and watch as our
        AI agents extract information using OCR, validate data, assess risks, and generate actionable insights. The system
        handles both digital and scanned documents, supporting multi-format extraction with PDF.js, Tesseract.js OCR, and
        Excel parsing capabilities.
      </p>
      <p>
        <strong>Try it out:</strong> Select a quick demo scenario below, or upload your own procurement documents to see
        the multi-agent workflow in action. Each agent specializes in a specific stage of the procurement lifecycle, from
        initial vendor intake to comprehensive supplier analytics.
      </p>
    </div>
  </div>

  <!-- Quick Demo Section -->
  <div id="demo" class="container my-5">
    <h3 class="text-center mb-4">Quick Demo Scenarios</h3>
    <div id="demo-cards" class="row g-3 justify-content-center mb-4"></div>
  </div>

  <!-- File Upload & Processing -->
  <div class="container my-5">
    <h3 class="text-center mb-4">Upload Documents for Processing</h3>

    <div class="row">
      <div class="col-lg-6 mb-4">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <i class="bi bi-cloud-upload me-2"></i>Document Upload
          </div>
          <div class="card-body">
            <div id="file-upload-zone" class="file-upload-zone">
              <i class="bi bi-file-earmark-arrow-up display-1 text-muted"></i>
              <p class="mt-3 mb-2"><strong>Drag & drop files here</strong></p>
              <p class="text-muted">or click to browse</p>
              <p class="text-muted small">Supported: PDF, Excel, Word, CSV, Images (JPG, PNG)</p>
              <input type="file" id="file-input" class="d-none" multiple accept=".pdf,.xlsx,.xls,.csv,.doc,.docx,.jpg,.jpeg,.png">
            </div>
            <div id="file-list" class="mt-3"></div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card">
          <div class="card-header bg-success text-white">
            <i class="bi bi-eye me-2"></i>Document Preview
          </div>
          <div class="card-body">
            <div id="file-preview" class="file-preview">
              <div class="text-center text-muted py-5">
                <i class="bi bi-file-earmark-text display-1 mb-3"></i>
                <p>No file selected for preview</p>
                <small>Upload files or run a demo, then click the "Preview" button</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center my-4">
      <button id="process-btn" class="btn btn-primary btn-lg" disabled>
        <i class="bi bi-play-circle me-2"></i>Process Documents
      </button>
    </div>
  </div>

  <!-- Sample Data Section -->
  <div id="data" class="container my-5">
    <h3 class="text-center mb-4">Sample Data Available</h3>
    <div class="row g-3">
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <i class="bi bi-file-earmark-text display-4 text-primary"></i>
            <h5 class="card-title mt-3">CSV Data</h5>
            <p class="card-text">Vendors, Invoices, POs, Supplier History</p>
            <button class="btn btn-sm btn-outline-primary load-sample" data-type="csv">Load Sample</button>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <i class="bi bi-file-pdf display-4 text-danger"></i>
            <h5 class="card-title mt-3">PDF Documents</h5>
            <p class="card-text">Invoices, Contracts, KYC Documents</p>
            <button class="btn btn-sm btn-outline-danger load-sample" data-type="pdf">Load Sample</button>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <i class="bi bi-file-earmark-excel display-4 text-success"></i>
            <h5 class="card-title mt-3">Excel Reports</h5>
            <p class="card-text">Vendor Database, Scorecards</p>
            <button class="btn btn-sm btn-outline-success load-sample" data-type="excel">Load Sample</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Processing Progress -->
  <div class="container my-5">
    <div id="processing-section" class="d-none">
      <h3 class="text-center mb-4">Processing Status</h3>

      <!-- Progress Timeline - Horizontal at top -->
      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          <i class="bi bi-list-check me-2"></i>Progress Timeline
        </div>
        <div class="card-body">
          <div id="progress-timeline" class="progress-timeline-horizontal"></div>
        </div>
      </div>

      <!-- Agent Output - Full width with more vertical space -->
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <i class="bi bi-terminal me-2"></i>Agent Output
        </div>
        <div class="card-body" style="min-height: 500px; max-height: 800px; overflow-y: auto;">
          <div id="agent-output"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Section -->
  <div class="container my-5">
    <div id="results-section" class="d-none">
      <h3 class="text-center mb-4">Processing Results</h3>
      <div id="results-output"></div>
    </div>
  </div>

  <!-- Settings Form -->
  <div class="container my-5">
    <form id="settings-form">
      <details class="card rounded-3 shadow-sm">
        <summary class="card-header d-flex justify-content-between align-items-center" style="cursor: pointer;">
          <div><i class="bi bi-gear me-2"></i> Advanced Settings</div>
          <button type="reset" class="btn btn-sm btn-outline-danger">Reset</button>
        </summary>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label" for="model">LLM Model</label>
              <input class="form-control" id="model" name="model" list="models" placeholder="Select a model..." value="gpt-5-mini"/>
              <datalist id="models">
                <option value="gpt-5-nano"></option>
                <option value="gpt-5-mini"></option>
                <option value="gpt-4.1-nano"></option>
                <option value="gpt-4.1-mini"></option>
              </datalist>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="temperature">Temperature</label>
              <input class="form-control" id="temperature" name="temperature" type="number" min="0" max="2" step="0.1" value="1" placeholder="1 (default)"/>
              <small class="form-text text-muted">Note: Some models only support default value (1)</small>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="ocr-enabled">
                <input class="form-check-input me-2" type="checkbox" id="ocr-enabled" name="ocr-enabled" checked>
                Enable OCR for scanned documents
              </label>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="auto-process">
                <input class="form-check-input me-2" type="checkbox" id="auto-process" name="auto-process">
                Auto-process on file upload
              </label>
            </div>
          </div>
        </div>
      </details>
    </form>
  </div>

  <footer class="bg-body-tertiary py-4 mt-5">
    <div class="container text-center">
      <p class="text-muted mb-0">
        <i class="bi bi-github me-2"></i>
        Source-to-Settle AI Demo | Powered by Multi-Agent LLM Architecture
      </p>
    </div>
  </footer>

  <script type="importmap">
    {
      "imports": {
        "asyncllm": "https://cdn.jsdelivr.net/npm/asyncllm@2.3.1",
        "bootstrap-alert": "https://cdn.jsdelivr.net/npm/bootstrap-alert@1.1.1",
        "bootstrap-llm-provider": "https://cdn.jsdelivr.net/npm/bootstrap-llm-provider@1.4.0",
        "highlight.js": "https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/+esm",
        "lit-html": "https://cdn.jsdelivr.net/npm/lit-html@3.3.1/+esm",
        "lit-html/directives/unsafe-html.js": "https://cdn.jsdelivr.net/npm/lit-html@3.3.1/directives/unsafe-html.js",
        "marked": "https://cdn.jsdelivr.net/npm/marked@13.0.3/+esm",
        "partial-json": "https://cdn.jsdelivr.net/npm/partial-json@0.1.7/+esm",
        "saveform": "https://cdn.jsdelivr.net/npm/saveform@1.4.0",
        "pdfjs-dist": "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.10.38/+esm",
        "xlsx": "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/+esm",
        "tesseract.js": "https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/+esm",
        "mammoth": "https://cdn.jsdelivr.net/npm/mammoth@1.8.0/+esm"
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@gramex/ui@0.3.1/dist/dark-theme.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="src/main.js"></script>
</body>

</html>
